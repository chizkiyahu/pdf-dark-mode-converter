<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PDF Dark Mode Converter - Secure, Local & Private Tool</title>
    <meta name="description" content="Convert PDFs to dark mode instantly with our privacy-focused offline tool. No uploads, 100% secure local processing.">
    <meta name="keywords" content="PDF dark mode, dark mode PDF, offline PDF converter, local PDF conversion, private PDF tool">
    <meta name="author" content="V Anbu Chelvan">
    <meta property="og:title" content="PDF Dark Mode Converter - Secure & Private">
    <meta property="og:description" content="Convert PDFs to comfortable dark mode reading with complete privacy - no uploads required.">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js";
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.11.0/pdf-lib.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+PHBhdGggZmlsbD0iIzAwN2JmZiIgZD0iTTE0LDJIMTBBMiwyIDAgMCwwIDgsNFYyMEEyLDIgMCAwLDAgMTAsMjJIMTRBMiwyIDAgMCwwIDE2LDIwVjRBMiwyIDAgMCwwIDE0LDJaIi8+PC9zdmc+">
    
    <style>
        /* Reset and Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0c0c0c 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
        }

        /* Header Styles */
        .header {
            margin-bottom: 40px;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #007bff, #0056b3);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            color: #b0b0b0;
            margin-bottom: 30px;
        }

        /* Privacy Notice */
        .privacy-notice {
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%);
            border: 1px solid #3d6a97;
            padding: 20px;
            border-radius: 12px;
            margin: 30px auto;
            max-width: 800px;
            box-shadow: 0 8px 32px rgba(0, 123, 255, 0.1);
        }

        .privacy-notice h3 {
            color: #64b5f6;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .privacy-notice p {
            color: #e3f2fd;
        }

        /* Upload Section */
        .upload-section {
            background: #1a1a1a;
            border: 2px dashed #333;
            padding: 60px 40px;
            border-radius: 16px;
            margin: 40px auto;
            max-width: 600px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .upload-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(0, 123, 255, 0.05) 0%, rgba(0, 86, 179, 0.05) 100%);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .upload-section:hover::before {
            opacity: 1;
        }

        .upload-section.dragover {
            border-color: #007bff;
            background: rgba(0, 123, 255, 0.05);
            transform: scale(1.02);
        }

        .file-input {
            display: none;
        }

        .upload-button {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            min-height: 44px;
            position: relative;
            z-index: 1;
        }

        .upload-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 123, 255, 0.3);
        }

        .upload-button:active {
            transform: translateY(0);
        }

        .upload-text {
            margin-top: 20px;
            color: #888;
            font-size: 0.95rem;
        }

        /* Settings Panel */
        .settings-panel {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 25px;
            margin: 30px auto;
            max-width: 500px;
            display: none;
        }

        .settings-panel.active {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .settings-panel h3 {
            color: #007bff;
            margin-bottom: 20px;
            font-size: 1.3rem;
        }

        .setting-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .setting-group label {
            display: block;
            margin-bottom: 8px;
            color: #ccc;
            font-weight: 500;
        }

        .setting-group select,
        .setting-group input[type="range"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #444;
            border-radius: 6px;
            background: #2a2a2a;
            color: white;
            font-size: 1rem;
        }

        .setting-group select {
            cursor: pointer;
        }

        .setting-group input[type="range"] {
            height: 44px;
            cursor: pointer;
        }

        .value-display {
            color: #007bff;
            font-weight: 600;
        }

        /* Progress Section */
        .progress-section {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 25px;
            margin: 30px auto;
            max-width: 600px;
            display: none;
        }

        .progress-section.active {
            display: block;
        }

        .progress-bar-container {
            width: 100%;
            height: 24px;
            background: #333;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #007bff 0%, #0056b3 100%);
            width: 0%;
            border-radius: 12px;
            transition: width 0.3s ease;
            position: relative;
        }

        .progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent 0%, rgba(255,255,255,0.2) 50%, transparent 100%);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            color: #ccc;
            font-size: 1rem;
            font-weight: 500;
        }

        .processing-status {
            color: #007bff;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Preview Section */
        .preview-section {
            margin: 40px auto;
            max-width: 800px;
            display: none;
        }

        .preview-section.active {
            display: block;
        }

        .preview-section h3 {
            color: #007bff;
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .preview-container {
            background: #1a1a1a;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            max-height: 600px;
            overflow-y: auto;
        }

        .preview-container canvas {
            max-width: 100%;
            height: auto;
            border: 1px solid #444;
            border-radius: 8px;
            margin: 10px 0;
        }

        /* Download Section */
        .download-section {
            margin: 40px auto;
            display: none;
        }

        .download-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .download-button {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            border: none;
            padding: 18px 36px;
            border-radius: 50px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            min-height: 44px;
        }

        .download-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 35px rgba(40, 167, 69, 0.3);
        }

        /* Error Messages */
        .error-message {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 600px;
            display: none;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 20px rgba(220, 53, 69, 0.3);
        }

        .error-message.active {
            display: flex;
            animation: slideInDown 0.3s ease;
        }

        @keyframes slideInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .success-message {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            margin: 20px auto;
            max-width: 600px;
            display: none;
            align-items: center;
            gap: 12px;
            box-shadow: 0 4px 20px rgba(40, 167, 69, 0.3);
        }

        .success-message.active {
            display: flex;
            animation: slideInDown 0.3s ease;
        }

        /* Loading Spinner */
        .loading-spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #007bff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 2rem;
            }

            .upload-section {
                padding: 40px 20px;
                margin: 20px auto;
            }

            .upload-button {
                padding: 14px 28px;
                font-size: 1rem;
            }

            .privacy-notice {
                padding: 15px;
                margin: 20px auto;
            }

            .settings-panel,
            .progress-section {
                margin: 20px auto;
                padding: 20px;
            }
        }

        /* Accessibility */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus styles for accessibility */
        .upload-button:focus,
        .download-button:focus,
        input:focus,
        select:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>PDF Dark Mode Converter</h1>
            <p class="subtitle">Transform your PDFs for comfortable night reading - 100% Private & Secure</p>
        </div>

        <!-- Privacy Notice -->
        <div class="privacy-notice">
            <h3>üîí Complete Privacy Protection</h3>
            <p>This tool processes your PDFs entirely on your device. No files are uploaded to any server, ensuring your documents remain completely private and secure. All processing happens locally in your browser.</p>
        </div>

        <!-- Error Message -->
        <div class="error-message" id="errorMessage">
            <span>‚ö†Ô∏è</span>
            <span id="errorText">An error occurred</span>
        </div>

        <!-- Success Message -->
        <div class="success-message" id="successMessage">
            <span>‚úÖ</span>
            <span id="successText">Conversion completed successfully!</span>
        </div>

        <!-- Upload Section -->
        <div class="upload-section" id="uploadSection">
            <input type="file" id="fileInput" class="file-input" accept="application/pdf" aria-describedby="upload-help">
            <label for="fileInput" class="upload-button" tabindex="0" role="button" aria-label="Choose PDF file to convert">
                <span>üìÅ</span>
                <span>Choose PDF File</span>
            </label>
            <div class="upload-text">
                <p>Click to select a PDF file or drag and drop it here</p>
                <small>Maximum file size: 50MB ‚Ä¢ Supported format: PDF</small>
            </div>
            <div class="sr-only" id="upload-help">Upload a PDF file to convert to dark mode. Drag and drop is also supported. Your file will be processed locally on your device.</div>
        </div>

        <!-- Settings Panel -->
        <div class="settings-panel" id="settingsPanel">
            <h3>‚öôÔ∏è Conversion Settings</h3>
            <div class="setting-group">
                <label for="darkModeType">Dark Mode Type:</label>
                <select id="darkModeType" aria-describedby="darkmode-help">
                    <option value="invert">Classic Invert (Recommended)</option>
                    <option value="sepia">Sepia Dark Mode</option>
                    <option value="highContrast">High Contrast</option>
                    <option value="grayscale">Grayscale Invert</option>
                </select>
                <div class="sr-only" id="darkmode-help">Choose the type of dark mode conversion to apply to your PDF</div>
            </div>
            <div class="setting-group">
                <label for="brightnessSlider">Brightness Adjustment: <span class="value-display" id="brightnessValue">0</span></label>
                <input type="range" id="brightnessSlider" min="-50" max="50" value="0" aria-describedby="brightness-help">
                <div class="sr-only" id="brightness-help">Adjust the brightness of the converted PDF from -50 to +50</div>
            </div>
            <div class="setting-group">
                <label for="contrastSlider">Contrast Adjustment: <span class="value-display" id="contrastValue">0</span></label>
                <input type="range" id="contrastSlider" min="-50" max="50" value="0" aria-describedby="contrast-help">
                <div class="sr-only" id="contrast-help">Adjust the contrast of the converted PDF from -50 to +50</div>
            </div>
        </div>

        <!-- Progress Section -->
        <div class="progress-section" id="progressSection">
            <h3>üîÑ Processing Your PDF</h3>
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div class="progress-text" id="progressText">Preparing conversion...</div>
            <div class="processing-status" id="processingStatus">
                <span class="loading-spinner"></span>
                <span>Please wait while we process your PDF...</span>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="preview-section" id="previewSection">
            <h3>üëÄ Preview - First 3 Pages</h3>
            <div class="preview-container" id="previewContainer"></div>
        </div>

        <!-- Download Section -->
        <div class="download-section" id="downloadSection">
            <button class="download-button" id="downloadButton" aria-label="Download the converted PDF in dark mode">
                <span>‚¨áÔ∏è</span>
                <span>Download Dark Mode PDF</span>
            </button>
            <div style="margin-top: 20px; color: #888;">
                <p>Your converted PDF is ready! The download should start automatically.</p>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let modifiedPdfBytes = null;
        let originalFileName = "";
        let currentSettings = {
            darkModeType: 'invert',
            brightness: 0,
            contrast: 0
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            setupEventListeners();
            setupDragAndDrop();
            updateSliderValues();
        }

        function setupEventListeners() {
            // File input change
            document.getElementById('fileInput').addEventListener('change', handleFileSelect);
            
            // Download button
            document.getElementById('downloadButton').addEventListener('click', triggerDownload);
            
            // Settings changes
            document.getElementById('darkModeType').addEventListener('change', updateSettings);
            document.getElementById('brightnessSlider').addEventListener('input', updateBrightness);
            document.getElementById('contrastSlider').addEventListener('input', updateContrast);
            
            // Keyboard accessibility for file upload
            document.querySelector('label[for="fileInput"]').addEventListener('keydown', function(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    document.getElementById('fileInput').click();
                }
            });
        }

        function setupDragAndDrop() {
            const uploadSection = document.getElementById('uploadSection');
            
            uploadSection.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadSection.classList.add('dragover');
            });
            
            uploadSection.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadSection.classList.remove('dragover');
            });
            
            uploadSection.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadSection.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                handleFile(file);
            }
        }

        function handleFile(file) {
            // Reset UI state
            hideAllMessages();
            hideAllSections();
            
            // Validate file
            if (!validateFile(file)) {
                return;
            }
            
            originalFileName = file.name.replace(/\.pdf$/i, '');
            
            // Show settings and start processing
            showSection('settingsPanel');
            
            // Process the file
            const fileReader = new FileReader();
            fileReader.onload = async function(e) {
                try {
                    showSection('progressSection');
                    await processPDF(new Uint8Array(e.result));
                } catch (error) {
                    console.error('PDF processing error:', error);
                    showError('Failed to process PDF. Please ensure it\'s a valid, non-encrypted PDF file.');
                    hideSection('progressSection');
                }
            };
            
            fileReader.onerror = function() {
                showError('Failed to read the file. Please try again.');
                hideSection('progressSection');
            };
            
            fileReader.readAsArrayBuffer(file);
        }

        function validateFile(file) {
            // Check file size (50MB limit)
            const maxSize = 50 * 1024 * 1024; // 50MB in bytes
            if (file.size > maxSize) {
                showError('File is too large. Please choose a PDF smaller than 50MB.');
                return false;
            }
            
            // Check file type
            if (!file.type.includes('pdf')) {
                showError('Please select a valid PDF file.');
                return false;
            }
            
            // Basic file signature check
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const arr = new Uint8Array(e.target.result);
                    const header = String.fromCharCode.apply(null, arr.subarray(0, 4));
                    if (header !== '%PDF') {
                        showError('Invalid PDF file format. Please select a valid PDF.');
                        resolve(false);
                    } else {
                        resolve(true);
                    }
                };
                reader.readAsArrayBuffer(file.slice(0, 4));
            }).then(isValid => {
                if (!isValid) return false;
                return true;
            }).catch(() => {
                showError('Error validating file. Please try again.');
                return false;
            });
        }

        async function processPDF(pdfData) {
            try {
                updateProgress(0, 'Loading PDF...');
                
                const pdfDoc = await PDFLib.PDFDocument.create();
                const pdf = await pdfjsLib.getDocument({ data: pdfData }).promise;
                
                const totalPages = pdf.numPages;
                const previewContainer = document.getElementById('previewContainer');
                previewContainer.innerHTML = '';
                
                updateProgress(10, `Processing ${totalPages} pages...`);
                
                for (let i = 0; i < totalPages; i++) {
                    const progress = 10 + ((i / totalPages) * 80);
                    updateProgress(progress, `Processing page ${i + 1} of ${totalPages}...`);
                    
                    const page = await pdf.getPage(i + 1);
                    const scale = 2; // High quality rendering
                    const viewport = page.getViewport({ scale });
                    
                    // Create canvas
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = viewport.width;
                    canvas.height = viewport.height;
                    
                    // Render PDF page to canvas
                    await page.render({
                        canvasContext: ctx,
                        viewport: viewport
                    }).promise;
                    
                    // Apply dark mode transformation
                    applyDarkModeEffect(ctx, canvas.width, canvas.height);
                    
                    // Add to preview (only first 3 pages)
                    if (i < 3) {
                        const previewCanvas = canvas.cloneNode();
                        const previewCtx = previewCanvas.getContext('2d');
                        previewCtx.drawImage(canvas, 0, 0);
                        previewContainer.appendChild(previewCanvas);
                    }
                    
                    // Convert to image and add to PDF
                    const imgBytes = await new Promise(resolve => {
                        canvas.toBlob(blob => {
                            blob.arrayBuffer().then(resolve);
                        }, 'image/png');
                    });
                    
                    const pngImage = await pdfDoc.embedPng(imgBytes);
                    const newPage = pdfDoc.addPage([viewport.width, viewport.height]);
                    newPage.drawImage(pngImage, {
                        x: 0,
                        y: 0,
                        width: viewport.width,
                        height: viewport.height
                    });
                }
                
                updateProgress(95, 'Finalizing PDF...');
                
                // Save the PDF
                modifiedPdfBytes = await pdfDoc.save();
                
                updateProgress(100, 'Conversion completed!');
                
                // Show preview and download sections
                showSection('previewSection');
                showSection('downloadSection');
                showSuccess('PDF converted successfully! Preview the first 3 pages above and download your dark mode PDF.');
                
                // Auto-download after a short delay
                setTimeout(triggerDownload, 1000);
                
            } catch (error) {
                console.error('Error processing PDF:', error);
                showError('An error occurred while processing the PDF. Please try with a different file.');
                hideSection('progressSection');
            }
        }

        function applyDarkModeEffect(ctx, width, height) {
            const imageData = ctx.getImageData(0, 0, width, height);
            const data = imageData.data;
            
            const { darkModeType, brightness, contrast } = currentSettings;
            
            for (let i = 0; i < data.length; i += 4) {
                let r = data[i];
                let g = data[i + 1];
                let b = data[i + 2];
                
                // Apply dark mode transformation
                switch (darkModeType) {
                    case 'invert':
                        r = 255 - r;
                        g = 255 - g;
                        b = 255 - b;
                        break;
                    case 'sepia':
                        const sepiaR = Math.min(255, (r * 0.393) + (g * 0.769) + (b * 0.189));
                        const sepiaG = Math.min(255, (r * 0.349) + (g * 0.686) + (b * 0.168));
                        const sepiaB = Math.min(255, (r * 0.272) + (g * 0.534) + (b * 0.131));
                        r = 255 - sepiaR;
                        g = 255 - sepiaG;
                        b = 255 - sepiaB;
                        break;
                    case 'highContrast':
                        const gray = (r + g + b) / 3;
                        const value = gray > 128 ? 0 : 255;
                        r = g = b = value;
                        break;
                    case 'grayscale':
                        const grayValue = 255 - (r * 0.299 + g * 0.587 + b * 0.114);
                        r = g = b = grayValue;
                        break;
                }
                
                // Apply brightness adjustment
                r = Math.max(0, Math.min(255, r + brightness));
                g = Math.max(0, Math.min(255, g + brightness));
                b = Math.max(0, Math.min(255, b + brightness));
                
                // Apply contrast adjustment
                const contrastFactor = (259 * (contrast + 255)) / (255 * (259 - contrast));
                r = Math.max(0, Math.min(255, contrastFactor * (r - 128) + 128));
                g = Math.max(0, Math.min(255, contrastFactor * (g - 128) + 128));
                b = Math.max(0, Math.min(255, contrastFactor * (b - 128) + 128));
                
                data[i] = r;
                data[i + 1] = g;
                data[i + 2] = b;
            }
            
            ctx.putImageData(imageData, 0, 0);
        }

        function updateProgress(percentage, message) {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressBar.style.width = percentage + '%';
            progressText.textContent = message;
            
            if (percentage >= 100) {
                setTimeout(() => {
                    hideSection('progressSection');
                }, 1000);
            }
        }

        function triggerDownload() {
            if (!modifiedPdfBytes) {
                showError('No converted PDF available. Please convert a PDF first.');
                return;
            }
            
            try {
                const blob = new Blob([modifiedPdfBytes], { type: 'application/pdf' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `${originalFileName}_dark_mode.pdf`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                URL.revokeObjectURL(url);
                
                showSuccess('Download started! Check your downloads folder.');
            } catch (error) {
                console.error('Download error:', error);
                showError('Failed to download the PDF. Please try again.');
            }
        }

        function updateSettings() {
            currentSettings.darkModeType = document.getElementById('darkModeType').value;
        }

        function updateBrightness() {
            const value = document.getElementById('brightnessSlider').value;
            currentSettings.brightness = parseInt(value);
            document.getElementById('brightnessValue').textContent = value;
        }

        function updateContrast() {
            const value = document.getElementById('contrastSlider').value;
            currentSettings.contrast = parseInt(value);
            document.getElementById('contrastValue').textContent = value;
        }

        function updateSliderValues() {
            document.getElementById('brightnessValue').textContent = currentSettings.brightness;
            document.getElementById('contrastValue').textContent = currentSettings.contrast;
        }

        // UI Helper Functions
        function showError(message) {
            const errorMsg = document.getElementById('errorMessage');
            const errorText = document.getElementById('errorText');
            errorText.textContent = message;
            errorMsg.classList.add('active');
            setTimeout(() => errorMsg.classList.remove('active'), 5000);
        }

        function showSuccess(message) {
            const successMsg = document.getElementById('successMessage');
            const successText = document.getElementById('successText');
            successText.textContent = message;
            successMsg.classList.add('active');
            setTimeout(() => successMsg.classList.remove('active'), 5000);
        }

        function showSection(sectionId) {
            document.getElementById(sectionId).classList.add('active');
        }

        function hideSection(sectionId) {
            document.getElementById(sectionId).classList.remove('active');
        }

        function hideAllSections() {
            const sections = ['settingsPanel', 'progressSection', 'previewSection', 'downloadSection'];
            sections.forEach(sectionId => hideSection(sectionId));
        }

        function hideAllMessages() {
            document.getElementById('errorMessage').classList.remove('active');
            document.getElementById('successMessage').classList.remove('active');
        }

        // Keyboard accessibility
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideAllMessages();
            }
        });
    </script>
</body>
</html>
